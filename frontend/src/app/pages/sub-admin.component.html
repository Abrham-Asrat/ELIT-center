<!-- Sub Admin Dashboard Header -->
<!-- Sub Admin Navigation Header -->
<div [@pageEnter]>
  <nav class="navbar navbar-expand-lg navbar-dark bg-success fixed-top shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#" [@slideInLeft]>
        <i class="fas fa-user-cog me-2"></i>
         <ng-container *ngIf="isLargeScreen; else smallBrand">
    ELIT ENT - {{ getPortalTitle() }}
  </ng-container>

  <ng-template #smallBrand>
    <ng-container *ngIf="currentUser?.workType; else portalLabel">
      ELIT-{{ currentUser.workType | titlecase }}
    </ng-container>
    <ng-template #portalLabel>ELIT-Portal</ng-template>
  </ng-template>
      </a>

      <div class="navbar-nav ms-auto">
        <div class="nav-item dropdown">
          <a
            class="nav-link dropdown-toggle"
            role="button"
            (click)="toggleDropdown($event)"
            [attr.aria-expanded]="isDropdownOpen"
            [@slideInRight]
          >
            <i class="fas fa-user-circle me-1"></i>
            {{ currentUser.name }}
          </a>
          <ul
            class="dropdown-menu dropdown-menu-end"
            [class.show]="isDropdownOpen"
            (clickOutside)="closeDropdown()"
            [@fadeIn]
          >
           
            <li>
              <a
                class="dropdown-item"
                (click)="goToAdminSelection(); closeDropdown()"
                [@slideInRight]
              >
                <i class="fas fa-arrow-left me-2"></i>Admin Selection
              </a>
            </li>
            <li>
              <a
                class="dropdown-item"
                (click)="goHome(); closeDropdown()"
                [@slideInRight]
              >
                <i class="fas fa-home me-2"></i>Go to HomePage
              </a>
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li>
              <a
                class="dropdown-item text-danger"
                (click)="logout(); closeDropdown()"
                [@slideInRight]
              >
                <i class="fas fa-sign-out-alt me-2"></i>Logout
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content Area with Sub Admin Stats Cards -->
  <div class="main-content-wrapper mt-3">
    <!-- Sub Admin Stats Cards -->
    <div
      class="container-fluid subAdmin"
      [class.tabs-sticky]="isNavSticky"
      [@staggerCards]
    >
      <!-- Default stats cards for non-doctor staff -->
      <div class="row g-4 mb-5" *ngIf="currentUser.workType !== 'doctor'">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-primary text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-calendar-day"></i>
            </div>
            <div class="stats-content">
              <h3>{{ todayAppointments }}</h3>
              <p>Appointments</p>
              <small class="opacity-75">{{ completedToday }} completed</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-info text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stats-content">
              <h3>{{ pendingTasks }}</h3>
              <p>Pending Tasks</p>
              <small class="opacity-75">{{ urgentTasks }} urgent</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-info text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stats-content">
              <h3>{{ patients.length }}</h3>
              <p>Total Patients</p>
              <small class="opacity-75">{{ activePatients }} active</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-success text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stats-content">
              <h3>{{ completedTasks }}%</h3>
              <p>Tasks Completed</p>
              <small class="opacity-75">This week</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Doctor-specific stats cards -->
      <div class="row g-4 mb-5" *ngIf="currentUser.workType === 'doctor'">
        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-primary text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-user-clock"></i>
            </div>
            <div class="stats-content">
              <h3>{{ pendingPatients }}</h3>
              <p>Pending Patients</p>
              <small class="opacity-75">Waiting for consultation</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-info text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-user-md"></i>
            </div>
            <div class="stats-content">
              <h3>{{ ongoingPatients }}</h3>
              <p>Ongoing Patients</p>
              <small class="opacity-75">Currently in consultation</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-success text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stats-content">
              <h3>{{ totalPatientsSeen }}</h3>
              <p>Total Patients Seen</p>
              <small class="opacity-75">By this doctor</small>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12" [@slideUp]>
          <div class="stats-card bg-gradient-warning text-white" [@scaleIn]>
            <div class="stats-icon">
              <i class="fas fa-vial"></i>
            </div>
            <div class="stats-content">
              <h3>{{ labResultsCount }}</h3>
              <p>Lab Results</p>
              <small class="opacity-75">New notifications</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Sub Admin Tabs -->
      <div class="sub-admin-tabs sticky-nav" [class.sticky]="isNavSticky">
        <ul class="nav nav-tabs mb-4" role="tablist">
          <li
            class="nav-item"
            role="presentation"
            [@slideInLeft]
            *ngIf="
              hasAccessTo('appointments') && currentUser.workType !== 'doctor'
            "
          >
            <button
              class="nav-link"
              [class.active]="isActiveTab('appointments')"
              (click)="switchTab('appointments')"
              type="button"
              role="tab"
              [@buttonHover]="buttonHover"
              (mouseenter)="buttonHover = 'hovered'"
              (mouseleave)="buttonHover = 'normal'"
            >
              <i class="fas fa-calendar-alt me-2"></i>Appointments
            </button>
          </li>
          <li
            class="nav-item"
            role="presentation"
            [@slideInLeft]
            *ngIf="hasAccessTo('patients')"
          >
            <button
              class="nav-link"
              [class.active]="isActiveTab('patients')"
              (click)="switchTab('patients')"
              type="button"
              role="tab"
              [@buttonHover]="buttonHover"
              (mouseenter)="buttonHover = 'hovered'"
              (mouseleave)="buttonHover = 'normal'"
            >
              <i class="fas fa-users me-2"></i>Patients
            </button>
          </li>
          <li
            class="nav-item"
            role="presentation"
            [@slideInLeft]
            *ngIf="hasAccessTo('patients') && currentUser.workType === 'doctor'"
          >
            <button
              class="nav-link"
              [class.active]="isActiveTab('results')"
              (click)="switchTab('results')"
              type="button"
              role="tab"
              [@buttonHover]="buttonHover"
              (mouseenter)="buttonHover = 'hovered'"
              (mouseleave)="buttonHover = 'normal'"
            >
              <i class="fas fa-file-medical me-2"></i>Results
            </button>
          </li>
          <li
            class="nav-item"
            role="presentation"
            [@slideInLeft]
            *ngIf="hasAccessTo('testimonials')"
          >
            <button
              class="nav-link"
              [class.active]="isActiveTab('testimonials')"
              (click)="switchTab('testimonials')"
              type="button"
              role="tab"
              [@buttonHover]="buttonHover"
              (mouseenter)="buttonHover = 'hovered'"
              (mouseleave)="buttonHover = 'normal'"
            >
              <i class="fas fa-star me-2"></i>Testimonials
            </button>
          </li>
          <li
            class="nav-item"
            role="presentation"
            [@slideInLeft]
            *ngIf="hasAccessTo('tasks')"
          >
            <button
              class="nav-link"
              [class.active]="isActiveTab('tasks')"
              (click)="switchTab('tasks')"
              type="button"
              role="tab"
              [@buttonHover]="buttonHover"
              (mouseenter)="buttonHover = 'hovered'"
              (mouseleave)="buttonHover = 'normal'"
            >
              <i class="fas fa-tasks me-2"></i>My Tasks
            </button>
          </li>
        </ul>
      </div>

      <!-- Placeholder to maintain space when tabs are sticky -->
      <div
        class="sticky-tabs-placeholder"
        *ngIf="isNavSticky"
        [style.height.px]="stickyTabsHeight"
      ></div>

      <!-- Tab Content -->
      <app-tab-content
        [activeTab]="activeTab"
        [currentUser]="currentUser"
        [todayAppointmentsList]="todayAppointmentsList"
        [waitingList]="waitingList"
        [patients]="patients"
        [testimonials]="testimonials"
        [myTasks]="myTasks"
        [serviceOptions]="serviceOptions"
        [timeOptions]="timeOptions"
        [totalTasks]="totalTasks"
        [completedTasksCount]="completedTasksCount"
        [pendingTasksCount]="pendingTasksCount"
        [overdueTasks]="overdueTasks"
        [showNewAppointmentForm]="showNewAppointmentForm"
        [showViewAppointmentModal]="showViewAppointmentModal"
        [showRescheduleModal]="showRescheduleModal"
        [showAddPatientModal]="showAddPatientModal"
        [showPatientHistoryModal]="showPatientHistoryModal"
        [showScheduleFollowUpModal]="showScheduleFollowUpModal"
        [showAddTaskModal]="showAddTaskModal"
        [newAppointment]="newAppointment"
        [newPatient]="newPatient"
        [followUpData]="followUpData"
        [rescheduleData]="rescheduleData"
        [newTask]="newTask"
        [viewedAppointment]="viewedAppointment"
        [viewedPatient]="viewedPatient"
        [patientSearch]="patientSearch"
        [patientHistory]="getFilteredPatientHistory()"
        (switchTab)="switchTab($event)"
        (addAppointment)="addAppointment()"
        (saveNewAppointment)="saveNewAppointment()"
        (cancelNewAppointment)="cancelNewAppointment()"
        (viewAppointment)="viewAppointment($event)"
        (closeViewAppointmentModal)="closeViewAppointmentModal()"
        (reschedule)="reschedule($event)"
        (saveReschedule)="saveReschedule()"
        (cancelReschedule)="cancelReschedule()"
        (markComplete)="markComplete($event)"
        (showAddPatientForm)="showAddPatientForm()"
        (saveNewPatient)="saveNewPatient()"
        (cancelAddPatient)="cancelAddPatient()"
        (searchPatients)="searchPatients()"
        (viewPatientHistory)="viewPatientHistory($event)"
        (closePatientHistoryModal)="closePatientHistoryModal()"
        (scheduleFollowUp)="scheduleFollowUp($event)"
        (saveFollowUp)="saveFollowUp()"
        (cancelScheduleFollowUp)="cancelScheduleFollowUp()"
        (approveTestimonial)="approveTestimonial($event)"
        (rejectTestimonial)="rejectTestimonial($event)"
        (addTask)="addTask()"
        (saveNewTask)="saveNewTask()"
        (cancelAddTask)="cancelAddTask()"
        (toggleTask)="toggleTask($event)"
        (editTask)="editTask($event)"
        (deleteTask)="deleteTask($event)"
      ></app-tab-content>
    </div>
  </div>
</div>

<!-- Modal Dialog -->
<div
  class="modal fade"
  [class.show]="modalState.isOpen"
  [style.display]="modalState.isOpen ? 'block' : 'none'"
  tabindex="-1"
  role="dialog"
  *ngIf="modalState.isOpen"
>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ modalState.title }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p>{{ modalState.content }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div
  class="modal-backdrop fade"
  [class.show]="modalState.isOpen"
  *ngIf="modalState.isOpen"
  (click)="closeModal()"
></div>
